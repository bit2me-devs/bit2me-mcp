# Bit2Me MCP Server - Technical Documentation

> Generated on 2025-12-06T02:13:19.356Z


==================================================
FILE: README.md (README / Documentation)
==================================================

# Bit2Me MCP Server

An [MCP (Model Context Protocol)](https://modelcontextprotocol.io/) server to interact with the [Bit2Me](https://bit2me.com/) ecosystem. This server allows AI assistants like Claude to access real-time market data, manage wallets, execute trading operations, and query products like Earn and Loans.

For more information, visit: **[https://mcp.bit2me.com](https://mcp.bit2me.com)**

**Bit2Me** is a leading cryptocurrency exchange based in Spain, offering a wide range of services including trading, staking (Earn), and loans. This MCP server acts as a bridge, enabling LLMs to perform actions and retrieve data securely from your Bit2Me account.

## üöÄ Features

- **General**: Asset information, account details, and portfolio valuation.
- **Wallet Management**: Query balances, transactions, and wallet (Pockets) details.
- **Pro Trading**: Manage orders (Limit, Market, Stop), query open orders, and transfer funds between Wallet and Pro.
- **Earn & Loans**: Manage Earn (Staking) strategies and collateralized loans.
- **Operations**: Execute trades, transfers, and withdrawals securely.

## üõ†Ô∏è Available Tools & API Endpoints

The server provides **46 tools** organized into categories:

- 2 General Tools
- 8 Broker (Simple Trading) Tools
- 4 Wallet Tools
- 11 Earn Tools
- 7 Loan Tools
- 14 Pro (Advanced Trading) Tools

_Note: Operation tools (write actions) are included in their respective categories above._

Below is a detailed list of tools and the Bit2Me API endpoints they use.

### ‚ÑπÔ∏è General

> **Note:** General information tools including asset details, account information, and portfolio valuation.

| Tool                        | Endpoint                                                   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| --------------------------- | ---------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `general_get_assets_config` | `GET /v2/currency/assets` or `/v2/currency/assets/:symbol` | Gets detailed information of assets (cryptocurrencies and fiat) supported by Bit2Me Wallet. If symbol is provided, returns details for that specific asset. If symbol is not provided, returns all available assets. Returns symbol, name, type, network (lowercase), trading status, loan availability, and supported pairs. Use this to discover available symbols or verify if a specific asset is tradeable or loanable before operations. |
| `portfolio_get_valuation`   | Multiple endpoints                                         | Calculates the total portfolio value by aggregating all assets across Wallet, Pro Trading, Earn/Staking, and Loans. Converts all holdings to the specified fiat symbol (default: EUR) using current market prices. Returns total value, breakdown by asset, and individual asset valuations.                                                                                                                                                   |

### üí± Broker (Simple Trading)

> **Note:** Tools for simple trading operations and broker prices. Includes market data (prices, charts) and trading actions (buy, sell, swap) for the Wallet/Broker service. These prices include spread and are different from Pro Trading prices.

| Tool                     | Endpoint                          | Description                                                                                                                                                                                                                                                                                                      |
| ------------------------ | --------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `broker_get_asset_price` | `GET /v1/currency/rate`           | Get Wallet exchange rates for cryptocurrencies in a specific quote symbol and date. Returns the price of one unit of the base symbol in the requested quote symbol (default: EUR) as used by the Wallet/Broker service. Optional base_symbol filter and date for historical rates. Response is a list of prices. |
| `broker_get_asset_data`  | `GET /v3/currency/ticker/:symbol` | Gets comprehensive market ticker data for a cryptocurrency from the Wallet/Broker service (not Pro Trading). These prices include spread and differ from Pro Trading prices. Requires base_symbol (e.g., BTC) and optional quote_symbol (default: EUR).                                                          |
| `broker_get_asset_chart` | `GET /v3/currency/chart`          | Gets Wallet price history (candles/chart) with date and price in the quote symbol. These prices reflect the Wallet/Broker service, not Pro Trading. Requires pair (e.g., BTC-USD) and timeframe (1h, 1d, 1w, 1M, 1y). Returns data points with ISO 8601 date/time and price in the quote symbol from the pair.   |

### üíº Wallet (Storage)

| Tool                          | Endpoint                      | Description                                                                                                                                                                                                                                                                                                                       |
| ----------------------------- | ----------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `wallet_get_pockets`          | `GET /v1/wallet/pocket`       | Gets balances, UUIDs, and available funds from Simple Wallet (Broker). Does not include Pro/Earn balance. Returns all pockets of the user. Optional `pocket_id` filter to get details of a specific pocket. Optional `symbol` filter. Returns balance, available, blocked funds, name, and creation date.                         |
| `wallet_get_movements`        | `GET /v2/wallet/transaction`  | History of past Wallet operations (deposits, withdrawals, swaps, purchases). Optional `movement_id` filter to get details of a specific movement. Optional `symbol` filter. Use limit and offset for pagination (default limit: 10). Returns movement list with type, amount, symbol, status, and date.                           |
| `wallet_get_pocket_addresses` | `GET /v2/wallet/pocket/...`   | Lists deposit addresses for a wallet (Pocket) on a specific network. Requires pocket_id and network. Use wallet_get_networks first to see available networks for a symbol. Each network may have different addresses. Returns address, network, and creation date. Use this address to receive deposits on the specified network. |
| `wallet_get_networks`         | `GET /v1/wallet/currency/...` | Lists available networks for a specific cryptocurrency. Requires symbol (e.g., BTC, ETH). Use this before wallet_get_pocket_addresses to see which networks support deposits for a symbol (e.g., bitcoin, ethereum, binanceSmartChain). Returns network ID, name, native symbol, fee symbol, and whether it requires a tag/memo.  |

### üí∞ Earn (Staking) Tools

| Tool                                | Endpoint                                   | Description                                                                                                                                                                                                                                                                                                                                          |
| ----------------------------------- | ------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `earn_get_summary`                  | `GET /v1/earn/summary`                     | View summary of accumulated rewards in Staking/Earn. Returns total rewards earned across all Earn positions, breakdown by symbol, and overall performance. Use this to see your total staking rewards.                                                                                                                                               |
| `earn_get_positions`                | `GET /v2/earn/wallets`                     | List active Earn positions/strategies. Optional `position_id` filter to get a specific position. Returns position_id, symbol, balance, strategy, lock_period, converted_balance, and timestamps. Note: Positions represent money that is locked or generating yield (invested money), different from Pockets which represent liquid available funds. |
| `earn_get_position_movements`       | `GET /v1/earn/wallets/:id/movements`       | Get movement history of a specific Earn position. Requires position_id. Returns deposits, withdrawals, and reward payments with amounts, dates, and status. Optional limit and offset for pagination. Use earn_get_positions first to get the position ID. Response is a paginated list with metadata.                                               |
| `earn_get_movements`                | `GET /v2/earn/movements`                   | Get movement history across all Earn positions. Returns deposits, withdrawals, rewards, and other movements with amounts, dates, rates, source, and issuer information. Supports filtering by symbol, position_id, type, date range, and pagination. All parameters are optional. Response is a paginated list with metadata.                        |
| `earn_get_movements_summary`        | `GET /v1/earn/movements/:type/summary`     | Get summary statistics of Earn movements filtered by type (deposit, withdrawal, reward, discount-funds, discount-rewards). Returns total count, total amounts, and aggregated data for the specified movement type across all Earn positions.                                                                                                        |
| `earn_get_assets`                   | `GET /v2/earn/assets`                      | Get list of assets (cryptocurrencies) supported in Earn/Staking with APY rates. Returns list of cryptocurrency symbols with their staking options and APY. Use this to discover which assets can be staked before creating Earn operations.                                                                                                          |
| `earn_get_rewards_config`           | `GET /v1/earn/wallets/rewards/config`      | Get global rewards configuration for Earn/Staking. Returns reward calculation rules, distribution schedules, and general staking parameters. Use this to understand how rewards are calculated.                                                                                                                                                      |
| `earn_get_position_rewards_config`  | `GET /v1/earn/wallets/:id/rewards/config`  | Get rewards configuration for a specific Earn position. Returns reward calculation rules, APY details, and position-specific staking parameters. Use earn_get_positions first to get the position ID.                                                                                                                                                |
| `earn_get_position_rewards_summary` | `GET /v1/earn/wallets/:id/rewards/summary` | Get rewards summary for a specific Earn position. Returns total rewards earned, pending rewards, reward history, and performance metrics. Use earn_get_positions first to get the position ID.                                                                                                                                                       |

### üè¶ Loan Tools

| Tool                  | Endpoint                              | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| --------------------- | ------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `loan_get_simulation` | `GET /v1/loan/ltv`                    | Simulate a loan scenario to calculate LTV (Loan To Value) ratio and APR. Requires guarantee_symbol, loan_symbol, and user_symbol. LTV represents the loan amount as a ratio of the guarantee value (1.0 = 100%). Lower LTV means lower risk. Provide either guarantee_amount or loan_amount (the other will be calculated). Returns guarantee and loan amounts (original and converted), LTV ratio, APR, and user currency. Use this before loan_create to plan your loan. |
| `loan_get_config`     | `GET /v1/loan/currency/configuration` | Get symbol configuration for loans including supported guarantee symbols, loan symbols, LTV limits, interest rates, and requirements. Returns symbol for each asset. Use this before creating a loan to understand available options and limits.                                                                                                                                                                                                                           |
| `loan_get_movements`  | `GET /v1/loan/movements`              | Get loan movement history including payments, interest accruals, and guarantee changes. Optional order_id filter to see movements for a specific loan. Use limit and offset for pagination. Response is a paginated list with metadata.                                                                                                                                                                                                                                    |
| `loan_get_orders`     | `GET /v1/loan/orders`                 | Get all loan orders (both active and closed) for the user. Optional `order_id` filter to get complete details of a specific order including LTV, APR, liquidation price, remaining amount, and expiration date. Without order_id, returns basic loan information. Optional limit and offset for pagination.                                                                                                                                                                |

### üìà Pro Trading Tools

| Tool                    | Endpoint                           | Description                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ----------------------- | ---------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `pro_get_balance`       | `GET /v1/trading/wallet/balance`   | Gets balances from PRO Trading account. This is separate from Simple Wallet - funds must be transferred using pro_deposit/pro_withdraw. Returns available and blocked balances per symbol for trading.                                                                                                                                                                                                                            |
| `pro_get_open_orders`   | `GET /v1/trading/order`            | View open trading orders in PRO. Optional `order_id` filter to get details of a specific order. Optional `pair` filter to see orders for a specific market. Returns all active orders with full details including pair, side, type, amount, price, status, filled amount, and creation date.                                                                                                                                      |
| `pro_get_trades`        | `GET /v1/trading/trade`            | Gets the user's trade history in Pro Trading. Returns executed trades with price, amount, side (buy/sell), fees, timestamp, and date. Optional filters: trading pair, side, order type, date range, limit (max 50), offset, and sort order (ASC/DESC). Use this to review past trading activity. Response is a paginated list with metadata.                                                                                      |
| `pro_get_order_trades`  | `GET /v1/trading/order/:id/trades` | Gets all individual trades (executions) associated with a specific order. Requires order_id. Returns detailed execution data including price, amount, fees, timestamp, and date for each fill. Useful for analyzing how a large order was executed across multiple trades.                                                                                                                                                        |
| `pro_get_market_config` | `GET /v1/trading/market-config`    | Gets market configuration including precision (decimal places), minimum/maximum amounts, and trading status. Optional pair filter for a specific market. Use this before placing orders to ensure amounts meet requirements. Response is a list of configurations.                                                                                                                                                                |
| `pro_get_order_book`    | `GET /v2/trading/order-book`       | Gets the order book (market depth) for a market showing current buy and sell orders. Requires trading pair (e.g., BTC-USD). Returns bids (buy orders) and asks (sell orders) with prices and amounts. Useful for analyzing market liquidity and determining optimal order prices. Response is a single object.                                                                                                                    |
| `pro_get_public_trades` | `GET /v1/trading/trade/last`       | Gets the latest public trades (executed orders) for a market. Requires trading pair (e.g., BTC-USD). Returns recent transactions with price, amount, side (buy/sell), and date. Optional limit (max 100) and sort order (ASC/DESC). Useful for seeing recent market activity. Response is a list of trades with metadata.                                                                                                         |
| `pro_get_candles`       | `GET /v1/trading/candle`           | Gets OHLCV (Open, High, Low, Close, Volume) candles for Pro (Advanced Trading). Requires trading pair (e.g., BTC-EUR) and timeframe (1m, 5m, 15m, 30m, 1h, 4h, 1d, 1w, 1M). Optional limit (default: 1000, max: 1000), startTime and endTime (Unix epoch milliseconds). If startTime/endTime not provided, defaults to last 24 hours. Essential for technical analysis and charting. Response is a list of candles with metadata. |
| `pro_get_ticker`        | `GET /v2/trading/tickers`          | Get ticker information (OHLCV, current best bid and ask, percentage versus price 24 hours ago) for all markets or by requested market symbol. The data refers to the last 24 hours from the date indicated by the timestamp. Optional pair filter for a specific market. Returns ticker data with open, close, bid, ask, high, low, volumes, and percentage change.                                                               |

### üìä Aggregation Tools

| Tool                      | Endpoint   | Description                                                                                                                                                                                                                                                                                                                                    |
| ------------------------- | ---------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `portfolio_get_valuation` | `GET /...` | Calculates the total portfolio value by aggregating all assets across Wallet, Pro Trading, Earn/Staking, and Loans. Converts all holdings to the specified fiat symbol (default: EUR) using current market prices. Returns total value, breakdown by asset, and individual asset valuations. Filters out dust amounts below minimum threshold. |

### ‚ö° Broker Operations (Write Actions)

| Tool                   | Endpoint                               | Description                                                                                                                                                                                                |
| ---------------------- | -------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `broker_quote_buy`     | `POST /v1/wallet/transaction/proforma` | **Step 1**: Buy cryptocurrency using fiat balance from a pocket. Creates a proforma quote. Use wallet_get_pockets to find pocket IDs. REQUIRES subsequent confirmation with broker_confirm_quote.          |
| `broker_quote_sell`    | `POST /v1/wallet/transaction/proforma` | **Step 1**: Sell cryptocurrency to receive fiat balance in a pocket. Creates a proforma quote. Use wallet_get_pockets to find pocket IDs. REQUIRES subsequent confirmation with broker_confirm_quote.      |
| `broker_quote_swap`    | `POST /v1/wallet/transaction/proforma` | **Step 1**: Swap/exchange one cryptocurrency for another between pockets. Creates a proforma quote. Use wallet_get_pockets to find pocket IDs. REQUIRES subsequent confirmation with broker_confirm_quote. |
| `broker_confirm_quote` | `POST /v1/wallet/transaction`          | **Step 2**: Confirms and executes a previously created proforma from broker_quote_buy, broker_quote_sell, or broker_quote_swap. Final action.                                                              |

### ‚ö° Pro Trading Operations (Write Actions)

| `pro_create_order` | `POST /v1/trading/order` | Create Limit/Market/Stop order in PRO Trading. Requires pair, side, type, and amount. For Limit orders, 'price' is required. For Stop-Limit orders, both 'price' and 'stop_price' are required. Market orders execute immediately at current price. Returns order with creation date and timestamp. Use pro_get_open_orders to check order status. |
| `pro_cancel_order` | `DELETE /v1/trading/order/:id` | Cancel a specific PRO order by ID. Requires order_id. Only open/pending orders can be cancelled. Returns cancellation status. Use pro_get_open_orders first to see which orders can be cancelled. |
| `pro_cancel_all_orders` | `DELETE /v1/trading/order` | Cancel all open orders in Pro Trading. Optional pair filter to cancel only orders for a specific market. Returns count of cancelled orders. Use with caution as this affects all pending orders. |
| `pro_deposit` | `POST /v1/trading/wallet/deposit` | Deposit funds from Simple Wallet to Pro Trading account. Funds must be available in Simple Wallet first (check with wallet_get_pockets). Transfer is immediate. Use pro_get_balance to verify the deposit. |
| `pro_withdraw` | `POST /v1/trading/wallet/withdraw` | Withdraw funds from Pro Trading account back to Simple Wallet. Funds must be available in Pro Trading (check with pro_get_balance). Transfer is immediate. Use wallet_get_pockets to verify the withdrawal. |
| `earn_deposit` | `POST /v1/earn/wallets/:id/movements` | Deposit funds from Simple Wallet pocket to Earn (Staking). Requires pocket_id, symbol (cryptocurrency), and amount. Funds will start earning rewards based on the asset's APY. Use wallet_get_pockets to find your pocket ID and earn_get_positions to see available Earn strategies. Returns operation details with status. |
| `earn_withdraw` | `POST /v1/earn/wallets/:id/movements` | Withdraw funds from Earn (Staking) back to Simple Wallet pocket. Requires pocket_id, symbol (cryptocurrency), and amount. Funds will stop earning rewards after withdrawal. Use earn_get_positions to check your Earn balance. Returns operation details with status. |
| `loan_create` | `POST /v1/loan` | Create a new loan by providing cryptocurrency as guarantee (collateral) to receive loan currency (can be any supported currency like USDC, EURC, or fiat). Requires guarantee_symbol, loan_symbol, and amount_type. Specify amount_type: 'fixed_collateral' (guarantee amount is fixed, loan amount is calculated) or 'fixed_loan' (loan amount is fixed, guarantee amount is calculated). This avoids mathematical errors where the model tries to guess the exact LTV manually. Returns loan order details with status. |
| `loan_increase_guarantee` | `POST /v1/loan/orders/:id/guarantee/increase` | Increase the guarantee (collateral) amount for an existing loan. Requires order_id and guarantee_amount. This improves the LTV ratio and reduces risk. Returns updated loan details. Use loan_get_orders first to get the order ID. |
| `loan_payback` | `POST /v1/loan/orders/:id/payback` | Pay back (return) part or all of a loan. Requires order_id and payback_amount. Reduces the loan amount and may release guarantee if fully paid. Returns updated loan details. Use loan_get_orders first to get the order ID, or loan_get_orders with order_id to check current loan amount. |

## üìã Response Schemas

All tool responses are **optimized for LLM consumption** with clean, consistent structures. We provide comprehensive documentation of response formats:

### üìñ Documentation Files

- **[SCHEMA_MAPPING.md](./docs/SCHEMA_MAPPING.md)** - Complete response schemas with field descriptions, types, enums, and examples for all 46 tools (auto-generated from `data/tools.json`)
- **[data/tools.json](./data/tools.json)** - Centralized metadata source for all tool definitions (name, description, inputSchema, responseSchema, examples)

### Key Features

- ‚úÖ **Consistent naming**: All fields use `snake_case` for better LLM readability
- ‚úÖ **Flattened structures**: Removed unnecessary nesting from API responses
- ‚úÖ **Filtered data**: Zero balances and irrelevant fields are removed
- ‚úÖ **Type-safe**: Full TypeScript interfaces in `src/utils/schemas.ts`
- ‚úÖ **Well-documented**: Every tool has a concrete JSON example and complete response schema with field descriptions
- ‚úÖ **Schema definitions**: All tools include `responseSchema` with detailed field descriptions, types, enums, and required/optional indicators
- ‚úÖ **Temporal parity**: All date fields include both ISO 8601 string (`*_at`) and Unix timestamp (`*_timestamp`)
- ‚úÖ **Normalized values**: Types, sides, currencies, and pairs are normalized for consistency
- ‚úÖ **Union types**: Status and type fields use controlled vocabularies (e.g., `"active" | "completed" | "failed"`)
- ‚úÖ **Enhanced metadata**: Paginated responses include `total_records`, `limit`, `offset`, and `has_more` flags
- ‚úÖ **Service breakdown**: Portfolio valuation includes `by_service` breakdown (wallet, pro, earn, loan_guarantees)

### Example

Instead of raw API responses like:

```json
{
    "data": [
        {
            "orderId": "...",
            "guaranteeSymbol": "BTC",
            "loanSymbol": "EUR",
            "createdAt": "2024-01-01T00:00:00.000Z"
        }
    ]
}
```

You get optimized responses like:

```json
[
    {
        "id": "...",
        "guarantee_symbol": "BTC",
        "loan_symbol": "EUR",
        "created_at": "2024-01-01T00:00:00.000Z"
    }
]
```

See [SCHEMA_MAPPING.md](./docs/SCHEMA_MAPPING.md) for complete response schemas with field descriptions and examples for all 46 tools.

## ‚öôÔ∏è Installation and Configuration

### Prerequisites

- **Node.js**: v18 or higher.
- **Bit2Me Account**: You need a verified Bit2Me account.

### üîë Generating API Keys

1. Go to your **[Bit2Me API Dashboard](https://app.bit2me.com/profile/api)**.
2. Click on **"New Key"**.
3. Select the permissions you need (e.g., Wallets, Trading, Earn, Loans).
    > **‚ö†Ô∏è Security Note:** This MCP server does **NOT** support crypto withdrawals to external blockchain addresses or transfers to other users. For security best practices, please **DO NOT** enable "Withdrawal" permissions on your API Key. Internal transfers between your own Bit2Me wallets (Wallet ‚Üî Pro ‚Üî Earn) are fully supported.

### Steps

1. **Clone the repository:**

    ```bash
    git clone https://github.com/bit2me-devs/bit2me-mcp.git
    cd bit2me-mcp
    ```

2. **Install dependencies:**

    ```bash
    npm install
    ```

3. **Configure environment variables:**
   Create a `.env` file in the root directory:

    ```bash
    cp .env.example .env
    ```

    Edit `.env` and add your keys:

    ```env
    BIT2ME_API_KEY=YOUR_BIT2ME_ACCOUNT_API_KEY
    BIT2ME_API_SECRET=YOUR_BIT2ME_ACCOUNT_API_SECRET

    # Optional Configuration
    BIT2ME_REQUEST_TIMEOUT=30000     # Request timeout in ms (default: 30000)
    BIT2ME_MAX_RETRIES=3             # Max retries for rate limits (default: 3)
    BIT2ME_RETRY_BASE_DELAY=1000     # Base delay for backoff in ms (default: 1000)
    BIT2ME_LOG_LEVEL=info            # Log level: debug, info, warn, error (default: info)
    ```

4. **Build the project:**
    ```bash
    npm run build
    ```

## üñ•Ô∏è Usage with Claude Desktop

To use this server with the Claude Desktop application, add the following configuration to your `claude_desktop_config.json` file:

### MacOS

`~/Library/Application Support/Claude/claude_desktop_config.json`

### Windows

`%APPDATA%\Claude\claude_desktop_config.json`

```json
{
    "mcpServers": {
        "bit2me": {
            "command": "node",
            "args": ["/absolute/path/to/bit2me-mcp/build/index.js"],
            "env": {
                "BIT2ME_API_KEY": "YOUR_BIT2ME_ACCOUNT_API_KEY",
                "BIT2ME_API_SECRET": "YOUR_BIT2ME_ACCOUNT_API_SECRET"
            }
        }
    }
}
```

> **Note:** Replace `/absolute/path/to/...` with the actual full path to your project.

## üõ°Ô∏è Security

### Security Policy

For detailed information about reporting vulnerabilities and our security policy, please see [SECURITY.md](./SECURITY.md).

### Best Practices

- **API Keys**: Never commit API keys to version control.
- **Permissions**: Use minimal permissions. Avoid "Withdrawal" permissions for MCP usage.
- **Logging**: The server automatically sanitizes sensitive data in logs.

## ‚ö†Ô∏è Rate Limits & Error Handling

The Bit2Me API enforces rate limits to ensure stability.

- **429 Too Many Requests**: If the server hits a rate limit, it will **automatically retry** the request after a 1-second delay (up to 3 retries).
- **Console Warnings**: You may see warnings in the logs if rate limits are hit.
- **Best Practice**: Avoid asking for massive amounts of data in a very short loop.
- **Exponential Backoff**: The server now uses exponential backoff with jitter for retries to handle rate limits more gracefully.

## üìä Logging

The server implements a structured logging system that automatically sanitizes sensitive data (API keys, signatures).
You can control the verbosity using the `BIT2ME_LOG_LEVEL` environment variable:

- `debug`: Detailed request/response logs (useful for development)
- `info`: Startup and operational events (default)
- `warn`: Rate limits and non-critical issues
- `error`: API errors and failures

## ‚ùì Troubleshooting

### Error: "Connection refused"

- Ensure the MCP server is running.
- Check that the path in `claude_desktop_config.json` points correctly to the `build/index.js` file.

### Error: "API Key invalid" or "Unauthorized"

- Verify your keys in `.env` or the Claude config.
- Ensure your API keys have the necessary permissions (Wallet, Trade, Earn, etc.) enabled in the Bit2Me dashboard.
- Check that there are no extra spaces or quotes around the API key values.

### Error: "Rate limit exceeded" or 429 responses

- The Bit2Me API has rate limits. The server automatically retries with exponential backoff.
- If you're hitting rate limits frequently, reduce the number of concurrent requests.
- Consider adding delays between operations in your workflows.

### Tools not showing up in Claude

- Restart Claude Desktop completely (quit and reopen).
- Check the Claude Desktop logs for initialization errors.
- Verify the configuration file syntax is valid JSON.

### Error: "Request timeout"

- Check your internet connection.
- Increase `BIT2ME_REQUEST_TIMEOUT` in your environment variables (default: 30000ms).
- Some Bit2Me API endpoints may be temporarily slow.

### Environment variables not loading

- When using `npx`, environment variables must be set in the config file's `env` section.
- For local development, ensure the `.env` file is in the project root.
- The server prioritizes config-provided credentials over `.env` file values.

### Error: "Network error" or CORS issues

- The MCP server runs server-side and doesn't have CORS restrictions.
- Network errors usually indicate connectivity problems or API downtime.
- Check the Bit2Me status page or try again later.

### Debugging

- Run the server manually to see logs:
    ```bash
    npm run dev
    ```
- Set `BIT2ME_LOG_LEVEL=debug` for detailed logging.
- Check Claude Desktop logs:
    - macOS: `~/Library/Logs/Claude/mcp*.log`
    - Windows: `%APPDATA%\Claude\logs\mcp*.log`

## üîç Testing with MCP Inspector

[MCP Inspector](https://github.com/modelcontextprotocol/inspector) is the official debugging tool for MCP servers. It provides a web interface to test your tools, view responses, and debug issues.

### Installation

```bash
npm install -g @modelcontextprotocol/inspector
```

### Running the Inspector

You have two options to run the inspector:

#### Option A: Using NPM Package (Recommended)

Use the published package from npm - no build required:

```bash
export BIT2ME_API_KEY=YOUR_BIT2ME_ACCOUNT_API_KEY
export BIT2ME_API_SECRET=YOUR_BIT2ME_ACCOUNT_API_SECRET
npx -y @modelcontextprotocol/inspector npx @bit2me/mcp-server
```

#### Option B: Using Local Repository

For development or testing unreleased changes:

```bash
# 1. Clone and build the project
git clone https://github.com/bit2me-devs/bit2me-mcp.git
cd bit2me-mcp
npm install
npm run build

# 2. Run the inspector
export BIT2ME_API_KEY=YOUR_BIT2ME_ACCOUNT_API_KEY
export BIT2ME_API_SECRET=YOUR_BIT2ME_ACCOUNT_API_SECRET
npx @modelcontextprotocol/inspector node build/index.js
```

**Note:** The inspector will automatically open at `http://localhost:5173`

### Using the Inspector

The web interface provides:

1. **Tools Tab:**
    - View all 47 available tools
    - See input schemas for each tool
    - Test tools with custom parameters
    - View formatted responses

2. **Resources Tab:**
    - Explore available resources (if any)

3. **Prompts Tab:**
    - Test prompt templates (if configured)

4. **Request/Response Logs:**
    - See all MCP protocol messages
    - Debug communication issues
    - View timing information

### Example: Testing a Tool

1. Navigate to the **Tools** tab
2. Select a tool (e.g., `market_get_ticker`)
3. Fill in the required parameters:
    ```json
    {
        "base_symbol": "BTC",
        "quote_symbol": "EUR"
    }
    ```
4. Click **Run** to execute the tool
5. View the formatted response in the output panel

## üåê Landing Page Deployment

The project's landing page is located in the `/landing` directory.
Deployment is automated using GitHub Actions.

**How to update the website:**

1. Edit the HTML/CSS files in `/landing`.
2. Push your changes to the `main` branch.
3. The `.github/workflows/deploy.yml` action will automatically publish the changes.

**Domain:**
The `/landing/CNAME` file manages the custom domain configuration.

## ü§ù Contributing

We welcome contributions to improve this MCP server! Whether it's fixing bugs, adding new tools, or improving documentation, your help is appreciated.

Please read our **[Contributing Guidelines](./CONTRIBUTING.md)** for details on:

- Setting up your development environment
- Running tests
- Commit conventions (Conventional Commits)
- Pull Request process

### Quick Start

1.  **Fork and Clone**:
    ```bash
    git clone https://github.com/bit2me-devs/bit2me-mcp.git
    ```
2.  **Install Dependencies**:
    ```bash
    npm install
    ```
3.  **Create a Branch**:
    ```bash
    git checkout -b feat/amazing-feature
    ```

For full details, check the [CONTRIBUTING.md](./CONTRIBUTING.md) file.

### Code of Conduct

Be respectful, inclusive, and constructive. We're all here to learn and build together.

## üìÑ License

[MIT License](./LICENSE)


==================================================
FILE: agents.md (Agent Rules & Conventions)
==================================================

# Agent Rules for Bit2Me MCP Server Repository

This document contains all the rules, conventions, and practices learned for managing this repository.

## üìã Table of Contents

1. [Commit Conventions](#commit-conventions)
2. [Versioning & Releases](#versioning--releases)
3. [API Response Mapping](#api-response-mapping)
4. [Testing](#testing)
5. [CI/CD Workflows](#cicd-workflows)
6. [NPM Publishing](#npm-publishing)
7. [Code Structure](#code-structure)
8. [Dependencies Management](#dependencies-management)
9. [Git Hooks](#git-hooks)
10. [Troubleshooting](#troubleshooting)

---

## Commit Conventions

### Rules

- **ALWAYS** use [Conventional Commits](https://www.conventionalcommits.org/) format
- **Format**: `<type>(<scope>): <subject>`
- **Types that trigger releases**:
    - `feat:` ‚Üí Minor version bump (1.1.0 ‚Üí 1.2.0)
    - `fix:` ‚Üí Patch version bump (1.1.0 ‚Üí 1.1.1)
    - `perf:` ‚Üí Patch version bump
- **Types that DON'T trigger releases**:
    - `chore:` - Build/dependency changes
    - `ci:` - CI/CD changes
    - `docs:` - Documentation only
    - `style:` - Code style changes
    - `refactor:` - Code refactoring
    - `test:` - Test changes
- **CRITICAL: All commit messages MUST be written in English**
    - Subject line must be in English
    - Body (if present) must be in English
    - No exceptions - this ensures consistency and compatibility with tools
- **Commitlint** validates all commits via Husky pre-commit hook

### Examples

```bash
feat: add optional raw_response support in mapped responses
fix: correct wallet address mapper and add pocket details mapper
ci: improve semantic-release npm configuration
docs: add NPM badge and link to README
chore(deps): bump zod from 4.1.12 to 4.1.13
```

---

## Versioning & Releases

### Semantic Release Configuration

- **Automated versioning** via Semantic Release
- **Configuration file**: `.releaserc.json`
- **Release rules**: Defined in `releaseRules` array
- **Branches**: Only `main` branch triggers releases
- **Node.js version**: Requires Node.js 22+ (Semantic Release requirement)

### Release Process

1. Push commits with `feat:` or `fix:` to `main`
2. Semantic Release analyzes commits since last tag
3. Generates new version based on commit types
4. Updates `CHANGELOG.md` and `package.json`
5. Creates Git tag (e.g., `v1.2.0`)
6. Publishes to NPM
7. Creates GitHub release

### Version Bump Rules

- **Major** (1.0.0 ‚Üí 2.0.0): Breaking changes (requires `BREAKING CHANGE:` in commit body)
- **Minor** (1.1.0 ‚Üí 1.2.0): New features (`feat:`)
- **Patch** (1.1.0 ‚Üí 1.1.1): Bug fixes (`fix:`, `perf:`)

### Important Notes

- Commits `chore:`, `ci:`, `docs:` do NOT trigger releases
- Semantic Release only runs on `main` branch
- Last tag determines which commits are analyzed
- If no release-worthy commits, workflow completes without error

---

## API Response Mapping

### Core Principles

- **Always map raw API responses** to optimized schemas
- **Use snake_case** for all field names (better for LLM consumption)
- **Flatten structures** - remove unnecessary nesting
- **Filter zero balances** and irrelevant fields
- **Provide defaults** for missing fields (empty strings, "0", etc.)

### Mapper Functions

- **Location**: `src/utils/response-mappers.ts`
- **Pattern**: `map<Entity>Response(raw: unknown): <Entity>Response`
- **Always validate** input with type guards (`isValidObject`, `isValidArray`)
- **Throw `ValidationError`** for invalid structures
- **Handle multiple field name variations** (e.g., `address`, `addr`, `addressValue`)

### Raw Response Support

- **Optional feature** via `BIT2ME_INCLUDE_RAW_RESPONSE` env var
- **Default**: `false` (raw responses excluded)
- **Usage**: Wrap mapped responses with `wrapResponseWithRaw()`
- **Purpose**: Debugging and completeness verification
- **Documentation**: See `docs/RAW_RESPONSE_GUIDE.md`

### Example Mapper Pattern

```typescript
export function mapWalletPocketDetailsResponse(raw: unknown): WalletPocketDetailsResponse {
    if (!isValidObject(raw)) {
        throw new ValidationError("Invalid wallet pocket details response structure");
    }

    return {
        id: raw.id || "",
        currency: raw.currency || "",
        balance: raw.balance || "0",
        available: raw.available || "0",
        blocked: raw.blocked || raw.blockedBalance || "0",
        name: raw.name,
        created_at: raw.createdAt || raw.created_at || "",
    };
}
```

### Schema Definitions

- **Location**: `src/utils/schemas.ts`
- **All schemas** must match mapper output
- **Use TypeScript interfaces** for type safety
- **Optional fields** marked with `?`
- **Required fields** have defaults in mappers

---

## Testing

### Test Structure

- **Framework**: Vitest
- **Location**: `tests/` directory
- **Pattern**: Mirror `src/` structure
- **Coverage target**: 97%+ (pragmatic approach)

### Test Files

- `tests/mappers.test.ts` - Response mapper tests
- `tests/tools/*.test.ts` - Tool handler tests
- `tests/config.test.ts` - Configuration tests
- `tests/auth.test.ts` - Authentication tests

### Mocking Rules

- **Always mock** `getConfig()` in tests
- **Set `INCLUDE_RAW_RESPONSE: false`** by default in test mocks
- **Mock external API calls** (Bit2Me API)
- **Use fixtures** for consistent test data (`tests/fixtures.ts`)

### Running Tests

```bash
npm test              # Run all tests
npm run test:watch    # Watch mode
npm run test:coverage # Generate coverage report
```

### Test Requirements

- **All mappers** must have tests
- **All tools** must have handler tests
- **Tests run automatically** on pre-commit (via lint-staged)
- **CI runs tests** before release

---

## CI/CD Workflows

### Workflows

1. **CI** (`.github/workflows/ci.yml`)
    - Runs on: Push to any branch, PRs
    - Steps: Lint, Test, Build
    - Node.js: 20

2. **Release** (`.github/workflows/release.yml`)
    - Runs on: Push to `main`
    - Steps: Build, Test, Semantic Release
    - Node.js: 22 (required for Semantic Release)
    - **Critical**: Requires `NPM_TOKEN` secret

3. **Deploy** (`.github/workflows/deploy.yml`)
    - Runs on: Push to `main`
    - Deploys landing page to GitHub Pages
    - Node.js: 20

### Release Workflow Steps

1. Checkout with `fetch-depth: 0` (needed for Semantic Release)
2. Setup Node.js 22 with npm cache
3. Install dependencies (`npm ci`)
4. Build (`npm run build`)
5. Test (`npm test`)
6. Configure npm authentication (`.npmrc`)
7. Run Semantic Release

### Required Secrets

- **`NPM_TOKEN`**: NPM automation token (type: Automation or Publish)
- **`GITHUB_TOKEN`**: Auto-provided by GitHub Actions

---

## NPM Publishing

### Configuration

- **Package name**: `@bit2me/mcp-server`
- **Access**: Public (`publishConfig.access: "public"`)
- **Provenance**: Enabled (`publishConfig.provenance: true`)
- **Registry**: `https://registry.npmjs.org`

### NPM Token Requirements

- **Type**: Must be "Automation" or "Publish" (NOT "Read-only")
- **Scope access**: Must have access to `@bit2me` scope
- **Location**: GitHub Secrets ‚Üí `NPM_TOKEN`
- **Expiration**: Set appropriate expiration (default: 90 days)

### Publishing Process

1. Semantic Release detects release-worthy commits
2. Updates version in `package.json`
3. Builds package (`prepublishOnly` hook)
4. Publishes to NPM registry
5. Creates Git tag
6. Creates GitHub release

### Troubleshooting NPM Publishing

- **Error: Invalid npm token**
    - Verify token type is "Automation" or "Publish"
    - Check token has `@bit2me` scope access
    - Verify token is not expired
    - Ensure `.npmrc` is configured in workflow

- **Error: Node version**
    - Semantic Release requires Node.js 22+
    - Update `node-version` in workflow to "22"

---

## Code Structure

### Directory Layout

```
src/
‚îú‚îÄ‚îÄ config.ts              # Environment configuration
‚îú‚îÄ‚îÄ constants.ts           # Constants and enums
‚îú‚îÄ‚îÄ index.ts              # Main entry point
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ bit2me.ts        # Bit2Me API client
‚îú‚îÄ‚îÄ tools/                # MCP tool handlers
‚îÇ   ‚îú‚îÄ‚îÄ account.ts
‚îÇ   ‚îú‚îÄ‚îÄ aggregation.ts
‚îÇ   ‚îú‚îÄ‚îÄ earn.ts
‚îÇ   ‚îú‚îÄ‚îÄ loan.ts
‚îÇ   ‚îú‚îÄ‚îÄ market.ts
‚îÇ   ‚îú‚îÄ‚îÄ pro.ts
‚îÇ   ‚îî‚îÄ‚îÄ wallet.ts
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ errors.ts         # Custom error classes
    ‚îú‚îÄ‚îÄ logger.ts         # Logging utilities
    ‚îú‚îÄ‚îÄ response-mappers.ts  # API response mappers
    ‚îî‚îÄ‚îÄ schemas.ts        # TypeScript interfaces
```

### File Naming

- **TypeScript files**: `.ts` extension
- **Test files**: `.test.ts` suffix
- **Use kebab-case** for file names (if needed)
- **Match directory structure** in tests

### Import Conventions

- **Use ES modules** (`import`/`export`)
- **Add `.js` extension** to imports (TypeScript requirement)
- **Group imports**: External ‚Üí Internal ‚Üí Types
- **Use type imports** when importing only types (`import type`)

---

## Dependencies Management

### Dependencies

- **Production**: Minimal, only runtime requirements
- **Dev**: Testing, linting, building tools
- **Update strategy**: Dependabot (weekly, grouped)

### Dependabot Configuration

- **Location**: `.github/dependabot.yml`
- **Schedule**: Weekly (Monday 09:00 Europe/Madrid)
- **Grouping**:
    - `dev-dependencies`: All dev deps together
    - `production-patches`: Production patches only
- **Commit prefix**: `chore(deps):` (doesn't trigger releases)

### Dependency Updates

- **Dependabot PRs**: Review and merge manually
- **Test locally** after merging dependency updates
- **Commit format**: `chore(deps): bump <package> from <old> to <new>`
- **No release** triggered by dependency updates

### Lock File

- **`package-lock.json`**: Always commit changes
- **Never ignore** lock file
- **Use `npm ci`** in CI (not `npm install`)

---

## Git Hooks

### Husky Configuration

- **Location**: `.husky/` directory
- **Pre-commit**: Runs lint-staged
- **Commit-msg**: Validates commit format (commitlint)

### Lint-Staged Rules

- **`*.ts`**: ESLint fix ‚Üí Prettier ‚Üí Vitest related tests
- **`*.{css,html,json,md}`**: Prettier only
- **Runs automatically** on `git commit`

### Commitlint

- **Config**: `.commitlintrc.json`
- **Enforces**: Conventional Commits format
- **Blocks commits** that don't follow convention

---

## Troubleshooting

### Semantic Release Not Publishing

1. **Check Node.js version**: Must be 22+
2. **Verify NPM_TOKEN**: Type must be "Automation" or "Publish"
3. **Check commit types**: Only `feat:` and `fix:` trigger releases
4. **Verify last tag**: Semantic Release analyzes commits since last tag
5. **Check workflow logs**: Look for authentication errors

### Tests Failing

1. **Mock `getConfig()`**: Required in all test files
2. **Set `INCLUDE_RAW_RESPONSE: false`** in test mocks
3. **Check fixtures**: Ensure test data matches expected format
4. **Run locally**: `npm test` to debug

### Build Errors

1. **TypeScript errors**: Check `tsconfig.json` configuration
2. **Missing types**: Install `@types/*` packages
3. **Import errors**: Verify `.js` extensions in imports

### NPM Token Issues

1. **Token type**: Must be "Automation" or "Publish"
2. **Scope access**: Verify `@bit2me` scope permissions
3. **Expiration**: Check token hasn't expired
4. **Secret name**: Must be exactly `NPM_TOKEN` in GitHub Secrets

### Git Hook Failures

1. **Husky not installed**: Run `npm install` (triggers `prepare` script)
2. **Commitlint error**: Fix commit message format
3. **Lint-staged error**: Fix linting/formatting issues

---

## Adding a New Tool

To add a new tool to the MCP server, follow this comprehensive checklist to ensure consistency, quality, and proper documentation.

### 1. Implementation (`src/tools/`)

1.  **Identify the category**: Choose an existing category (e.g., `wallet`, `market`, `earn`) or create a new one if necessary.
2.  **Create/Update file**: Edit `src/tools/<category>.ts`.
3.  **Define Tool Definition**: Add the tool definition to the `tools` array.
4.  **Implement Handler**: Add the logic to the `handle<Category>Tool` function.

```typescript
// src/tools/example.ts

export const exampleTools: Tool[] = [
    {
        name: "example_get_data",
        description: "Get example data from Bit2Me API",
        inputSchema: {
            type: "object",
            properties: {
                id: { type: "string", description: "Resource ID" },
            },
            required: ["id"],
        },
    },
];

export async function handleExampleTool(name: string, args: any) {
    if (name === "example_get_data") {
        const { id } = args;
        const data = await bit2meRequest("GET", `/v1/example/${id}`);
        const optimized = mapExampleResponse(data);
        return { content: [{ type: "text", text: JSON.stringify(optimized, null, 2) }] };
    }
    throw new Error(`Unknown tool: ${name}`);
}
```

### 2. Response Mapping (`src/utils/`)

1.  **Define Schema**: Add the TypeScript interface in `src/utils/schemas.ts`.
2.  **Create Mapper**: Add the mapper function in `src/utils/response-mappers.ts`.

```typescript
// src/utils/schemas.ts
export interface ExampleResponse {
    id: string;
    value: string;
    created_at: string;
}

// src/utils/response-mappers.ts
export function mapExampleResponse(raw: any): ExampleResponse {
    if (!isValidObject(raw)) throw new ValidationError("Invalid response");

    return {
        id: raw.id || "",
        value: raw.val || raw.value || "0",
        created_at: raw.createdAt || "",
    };
}
```

### 3. Registration (`src/index.ts`)

1.  **Import**: Import the tools array and handler.
2.  **List Tools**: Add `...exampleTools` to `ListToolsRequestSchema`.
3.  **Handle Call**: Add the handler condition to `CallToolRequestSchema`.

```typescript
// src/index.ts
import { exampleTools, handleExampleTool } from "./tools/example.js";

// ... inside ListToolsRequestSchema
tools: [
    // ...
    ...exampleTools,
];

// ... inside CallToolRequestSchema
if (exampleTools.find((t) => t.name === name)) {
    return await handleExampleTool(name, args);
}
```

### 4. Testing (`tests/`)

1.  **Mapper Tests**: Add test cases in `tests/mappers.test.ts`.
2.  **Tool Tests**: Create `tests/tools/example.test.ts`.

```typescript
// tests/tools/example.test.ts
import { describe, it, expect, vi } from "vitest";
import { handleExampleTool } from "../../src/tools/example.js";
import { bit2meRequest } from "../../src/services/bit2me.js";

vi.mock("../../src/services/bit2me.js");

describe("Example Tools", () => {
    it("should handle example_get_data", async () => {
        vi.mocked(bit2meRequest).mockResolvedValue({ id: "123", val: "test" });

        const result = await handleExampleTool("example_get_data", { id: "123" });
        const content = JSON.parse(result.content[0].text);

        expect(content.id).toBe("123");
    });
});
```

### 5. Documentation

1.  **SCHEMA_MAPPING.md**: Add the JSON response example.
2.  **README.md**: Add the tool to the list of available tools.
3.  **Landing Page**: Update `landing/index.html` if it lists features/tools.
4.  **Product Documentation**: Update `docs/PRODUCT.md` (if applicable).
5.  **Schema Coverage**: Update `docs/TYPESCRIPT_SCHEMA_COVERAGE.md` to map the new tool to its TypeScript interface.

### 6. Verification

1.  Run `npm test` to ensure all tests pass.
2.  Run `npm run build` to verify TypeScript compilation.
3.  (Optional) Run the server locally and test with a client.

---

## Quick Reference

### Common Commands

```bash
# Development
npm run build          # Build TypeScript
npm run dev            # Run server
npm test               # Run tests
npm run test:watch     # Watch mode
npm run lint           # Lint code
npm run eslint:fix     # Fix linting issues

# Git
git commit -m "feat: add new feature"  # Triggers release
git commit -m "fix: fix bug"            # Triggers patch release
git commit -m "chore: update deps"     # No release

# Release
# Automatic via Semantic Release on push to main
```

### Important Files

- `.releaserc.json` - Semantic Release configuration
- `.github/workflows/release.yml` - Release workflow
- `src/utils/response-mappers.ts` - API response mappers
- `src/utils/schemas.ts` - TypeScript interfaces
- `package.json` - Dependencies and scripts
- `.commitlintrc.json` - Commit message validation

### Critical Rules Summary

1. ‚úÖ **Always use Conventional Commits**
2. ‚úÖ **Only `feat:` and `fix:` trigger releases**
3. ‚úÖ **Map all API responses** to optimized schemas
4. ‚úÖ **Mock `getConfig()` in tests**
5. ‚úÖ **Node.js 22+ required** for Semantic Release
6. ‚úÖ **NPM_TOKEN must be Automation/Publish type**
7. ‚úÖ **Always commit `package-lock.json`**
8. ‚úÖ **Use snake_case** for API response fields
9. ‚úÖ **Provide defaults** for all mapper fields
10. ‚úÖ **Test before committing** (hooks run automatically)

---

**Last Updated**: Based on repository state as of latest changes
**Maintainer**: Follow these rules to ensure consistent repository management


==================================================
FILE: CHANGELOG.md (Changelog)
==================================================

## [Unreleased]

### Breaking Changes

- **reorganization:** Major reorganization of tool categories to improve semantic clarity for AI models:
    - **New category `broker` (Simple Trading):** Created new category consolidating broker market data and trading operations:
        - `market_get_ticker` ‚Üí `broker_get_assets_price`
        - `market_get_data` ‚Üí `broker_get_asset_data` (previously renamed to `broker_get_price_info`)
        - `market_get_chart` ‚Üí `broker_get_asset_chart`
        - `wallet_buy_crypto` ‚Üí `broker_quote_buy`
        - `wallet_sell_crypto` ‚Üí `broker_quote_sell`
        - `wallet_swap_crypto` ‚Üí `broker_quote_swap`
        - `wallet_confirm_operation` ‚Üí `broker_confirm_quote`
    - **Category `general`:** Contains `general_get_assets_config` (asset information, previously `get_assets_details`)
    - **Category `wallet`:** Now only contains storage/balance tools (pockets, movements, addresses, cards)

    This reorganization provides clearer semantic separation: "Wallet" for storage/balances, "Broker" for simple trading and broker prices, and "Pro" for advanced trading. This prevents AI models from confusing Broker prices (which include spread) with Pro Trading prices when making trading decisions.

- **earn:** Rename Earn tools to use "position" terminology instead of "wallet" for better clarity:
    - `earn_get_wallets` ‚Üí `earn_get_positions`
    - `earn_get_wallet_details` ‚Üí `earn_get_position_details`
    - `earn_get_wallet_movements` ‚Üí `earn_get_position_movements`
    - `earn_get_wallet_rewards_config` ‚Üí `earn_get_position_rewards_config`
    - `earn_get_wallet_rewards_summary` ‚Üí `earn_get_position_rewards_summary`
    - Parameter `wallet_id` ‚Üí `position_id` in all Earn tools
    - Response fields `wallet_id` ‚Üí `position_id` (backward compatibility: `wallet_id` still included in responses)

    This change clarifies that Earn "positions" represent money that is locked or generating yield (invested money), different from Wallet "pockets" which represent liquid available funds.

- **timeframes:** Standardize timeframe notation to trading standard and migrate validations to strict enums:
    - **Unified notation:** Changed `broker_get_asset_chart` timeframe from natural language ("one-hour", "one-day", "one-week", "one-month", "one-year") to trading notation ("1h", "1d", "1w", "1M", "1y") to match `pro_get_candles` and industry standards (TradingView, CCXT)
    - **Strict validation:** Added `enum` arrays to `inputSchema` for `broker_get_asset_chart` and `pro_get_candles` timeframe parameters, preventing LLM hallucinations and ensuring server-side validation
    - **Internal conversion:** Added `convertBrokerTimeframe()` function to map trading notation to API format internally, maintaining backward compatibility with API expectations

    This improvement reduces ambiguity for LLMs, saves tokens, unifies logic between Broker and Pro Trading tools, and provides robust validation at the schema level.

## [1.8.4](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.8.3...v1.8.4) (2025-12-04)

### Bug Fixes

- **tests:** require explicit RUN_E2E=true to run E2E tests ([1eeda55](https://github.com/bit2me-devs/bit2me-mcp/commit/1eeda5573742a7f680e3013667e2f04ce40512d4))

## [1.8.3](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.8.2...v1.8.3) (2025-12-04)

### Bug Fixes

- **tests:** read version dynamically from package.json ([61e0603](https://github.com/bit2me-devs/bit2me-mcp/commit/61e0603c462f07d879063ef31a711848cf40d438))

## [1.8.2](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.8.1...v1.8.2) (2025-12-04)

### Bug Fixes

- **ci:** correct github/codeql-action SHA to valid v4 commit ([1cbc342](https://github.com/bit2me-devs/bit2me-mcp/commit/1cbc34296dfc93f96895c2a2488d16f47e39ad97))
- **tests:** update expected version to 1.8.1 in index.test.ts ([d778298](https://github.com/bit2me-devs/bit2me-mcp/commit/d778298d537844e1bdeb31f9088537e6fadb37a3))

## [1.8.1](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.8.0...v1.8.1) (2025-12-04)

### Bug Fixes

- **ci:** correct ossf/scorecard-action SHA to valid v2.4.0 commit ([234d06e](https://github.com/bit2me-devs/bit2me-mcp/commit/234d06ea494868e5638d3f466813d62403e5836a))
- **tests:** update expected version to 1.8.0 in index.test.ts ([d6f1d8c](https://github.com/bit2me-devs/bit2me-mcp/commit/d6f1d8c92ba99d3c5d3a614ce914f3096293adb0))

# [1.8.0](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.7.0...v1.8.0) (2025-12-04)

### Bug Fixes

- **ci:** update codecov action to valid version ([6b6d4e5](https://github.com/bit2me-devs/bit2me-mcp/commit/6b6d4e5c374d5445fa51ae16efad84eb0d9b8731))
- correct API endpoints for wallet and earn tools ([ef1f892](https://github.com/bit2me-devs/bit2me-mcp/commit/ef1f892e1f9d920dbba5f2272329098cb4a4d0b5))
- correct mapCurrencyRateResponse for actual API structure ([262e376](https://github.com/bit2me-devs/bit2me-mcp/commit/262e37655f39264adb45c7057f67a1d3068ab155))
- earn_get_summary response format and remove apy ([75ab614](https://github.com/bit2me-devs/bit2me-mcp/commit/75ab614578909961a7d631d13a31ba852da832a8))
- extract transactions array from v2 API response ([8454b89](https://github.com/bit2me-devs/bit2me-mcp/commit/8454b8955b3b108a568d3cab565e7a8a0cb87567))
- handle nested array response in earn_get_summary ([5f95bd9](https://github.com/bit2me-devs/bit2me-mcp/commit/5f95bd91744e285c4c74661af051f2fe2f32a567))
- handle nested data structure in earn_get_wallets and ignore docs/ ([b75cbad](https://github.com/bit2me-devs/bit2me-mcp/commit/b75cbad56d7f38c4814357bb1003c1073bb837f8))
- **market:** remove chart data limit and rename ticker parameter to pair ([b58308b](https://github.com/bit2me-devs/bit2me-mcp/commit/b58308b0c3ab42af5f958e56eead4c7bfbbb0675))
- pin all GitHub Actions to specific commit SHAs ([b2c9db4](https://github.com/bit2me-devs/bit2me-mcp/commit/b2c9db42bb9e0eb3f786e8a5642774fd4b5341fa))
- remove redundant null check in mapEarnSummaryResponse ([2ca291e](https://github.com/bit2me-devs/bit2me-mcp/commit/2ca291e76edd657250594f9ef869ea718befe700))
- remove unused imports and improve type checking ([f11b881](https://github.com/bit2me-devs/bit2me-mcp/commit/f11b881763b497ba36ffbfae53b7ada6445aab1b))
- remove unused type imports from market.ts ([f87d39c](https://github.com/bit2me-devs/bit2me-mcp/commit/f87d39c5ebc4258d757322e1f3064565ee684dd5))
- resolve CodeQL warnings ([b155ee8](https://github.com/bit2me-devs/bit2me-mcp/commit/b155ee87bd80b71623e88eb9084ccdd0ea9eb8dc)), closes [#59](https://github.com/bit2me-devs/bit2me-mcp/issues/59) [#70](https://github.com/bit2me-devs/bit2me-mcp/issues/70) [#77](https://github.com/bit2me-devs/bit2me-mcp/issues/77)
- resolve security and code quality issues ([9346c46](https://github.com/bit2me-devs/bit2me-mcp/commit/9346c46a3c39b48c199d0ec269bb4ec773711d85))
- **tests:** add config mock to edge-cases and portfolio tests ([ff406a4](https://github.com/bit2me-devs/bit2me-mcp/commit/ff406a41a04a672981c3835fc533dda63a4d6589))
- update codeql-action SHA in gitleaks workflow for consistency ([e94075d](https://github.com/bit2me-devs/bit2me-mcp/commit/e94075dad7165e2a24dc2bd00377cae4d7ed8a27))
- update portfolio_get_valuation to use v2 earn endpoint and fix pro balance calculation ([acab884](https://github.com/bit2me-devs/bit2me-mcp/commit/acab884c154f7960973974d953c37a8934e412f5))
- update wallet_get_transactions to match correct API schema ([25ec140](https://github.com/bit2me-devs/bit2me-mcp/commit/25ec1401b84923bb39092af51f7e4254655a6a04))

### Features

- add CurrencyRateResponse schema interface ([44df338](https://github.com/bit2me-devs/bit2me-mcp/commit/44df338a0cff53fc5156521b9ce1d58b6b8729d8))
- apply smartRound formatting to all price-returning tools ([32162bd](https://github.com/bit2me-devs/bit2me-mcp/commit/32162bdc004edaeebc101d9d993869bc88f3796e))
- implement market_get_currency_rate tool ([bce4955](https://github.com/bit2me-devs/bit2me-mcp/commit/bce4955034a835c8c8db79d0c9eca8eef6de2aae))
- **loan:** revamp loan tools and terminology ([aa3b48e](https://github.com/bit2me-devs/bit2me-mcp/commit/aa3b48efb623810d5b3e9d2d1feeb30158b0ce61))
- **wallet/earn:** add cards support and improve rewards ([f9fd3a9](https://github.com/bit2me-devs/bit2me-mcp/commit/f9fd3a9bde3bc643d32580d08e05e2793197f232))

# [1.7.0](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.6.3...v1.7.0) (2025-11-29)

### Bug Fixes

- add attestations write permission for build provenance ([b9dc332](https://github.com/bit2me-devs/bit2me-mcp/commit/b9dc33261707f21a71b892b8fc2f5c7eee00f0ce))
- **build:** use html-minifier-terser for robust minification ([4bb1ac3](https://github.com/bit2me-devs/bit2me-mcp/commit/4bb1ac36c5fdeb7e654853117021fb2096fdc742))
- correct wallet transaction confirmation and add currency filter to pockets ([0d2cf82](https://github.com/bit2me-devs/bit2me-mcp/commit/0d2cf8277b94b121a189afdeafd5a61967ee46a2))
- pin upload-pages-artifact action by commit hash to resolve security alert ([70ea476](https://github.com/bit2me-devs/bit2me-mcp/commit/70ea476cc175f32a46be525371b14b358e298c11))
- return full ISO date time in market_get_chart tool instead of date only ([7c13998](https://github.com/bit2me-devs/bit2me-mcp/commit/7c13998e4f9a41611513e9b3b6144a4844442d33))
- **tests:** remove unused import expect from vitest ([2aba1bf](https://github.com/bit2me-devs/bit2me-mcp/commit/2aba1bf4ea378b2a7f23afbecae38bcd3af6f51f))
- update attest-build-provenance action to v2 ([673a9af](https://github.com/bit2me-devs/bit2me-mcp/commit/673a9afeb84bdc1bdee26ba4b406933837f90408))

### Features

- **build:** add HTML minification for production only ([5fe4559](https://github.com/bit2me-devs/bit2me-mcp/commit/5fe45591ff154796e138f30837dabc8b4f4b5e14))
- **landing:** improve usage examples with all parameters and responses ([14dcac3](https://github.com/bit2me-devs/bit2me-mcp/commit/14dcac36b6a37bff56f6cf84672495ed8175828d))

## [1.6.3](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.6.2...v1.6.3) (2025-11-28)

### Bug Fixes

- address incomplete sanitization alert using replacement loop ([f020b6e](https://github.com/bit2me-devs/bit2me-mcp/commit/f020b6e75446778416dc6705c2d0b8b45f002b08))

## [1.6.2](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.6.1...v1.6.2) (2025-11-28)

### Bug Fixes

- address remaining security scanning alerts ([730dab4](https://github.com/bit2me-devs/bit2me-mcp/commit/730dab4b3c66d2bc416c20f000dac444a606da71))

## [1.6.1](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.6.0...v1.6.1) (2025-11-28)

### Bug Fixes

- resolve high severity security alerts ([fcaa6f0](https://github.com/bit2me-devs/bit2me-mcp/commit/fcaa6f07ae0d4535c79ddf3b730055ca47c4f0f5))

# [1.6.0](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.5.0...v1.6.0) (2025-11-28)

### Features

- add robots.txt to landing page ([f13294b](https://github.com/bit2me-devs/bit2me-mcp/commit/f13294bb0a6182bff892d7e763b721a787dd43e1))

# [1.5.0](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.4.1...v1.5.0) (2025-11-28)

### Features

- implement automatic generation of llms.txt and llms-full.txt ([9b95992](https://github.com/bit2me-devs/bit2me-mcp/commit/9b959924d235ef440c11704be4286c782f015fa8))

## [1.4.1](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.4.0...v1.4.1) (2025-11-27)

### Bug Fixes

- resolver alertas de CodeQL security scanning ([dc432e7](https://github.com/bit2me-devs/bit2me-mcp/commit/dc432e769c7373e3981b6b541b734717bf7d1b31))

# [1.4.0](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.3.1...v1.4.0) (2025-11-27)

### Features

- add Google Analytics to landing page ([ec61650](https://github.com/bit2me-devs/bit2me-mcp/commit/ec616502fcf21206b45f2b2becd4c8e416353af4))

## [1.3.1](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.3.0...v1.3.1) (2025-11-27)

### Bug Fixes

- reorganize imports in wallet.ts to match export order ([969cf5b](https://github.com/bit2me-devs/bit2me-mcp/commit/969cf5b9562a84753c516f0ddf627b3e12b1b7f3))

# [1.3.0](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.2.0...v1.3.0) (2025-11-27)

### Bug Fixes

- remove deprecated husky lines ([545c3eb](https://github.com/bit2me-devs/bit2me-mcp/commit/545c3eba36fbe3d2bf4577b66479f083961f2730))
- remove currency parameter from wallet_get_pockets ([0c74d73](https://github.com/bit2me-devs/bit2me-mcp/commit/0c74d73b6b967e14bf7375ae46fb83ca5e515585))

### Features

- update tools, mappers and documentation ([34af228](https://github.com/bit2me-devs/bit2me-mcp/commit/34af228ca9acfeb0f6b33c77b7c26f23aaccbe02))

# [1.2.0](https://github.com/bit2me-devs/bit2me-mcp/compare/v1.1.1...v1.2.0) (2025-11-27)

### Bug Fixes

- add config mock to wallet tests ([84048b4](https://github.com/bit2me-devs/bit2me-mcp/commit/84048b49d24e74200803429edfb254372445b707))
- configure npm registry authentication before semantic-release ([15fe81f](https://github.com/bit2me-devs/bit2me-mcp/commit/15fe81f8bebe146c5bbec932333b36694bf4adb0))
- configure semantic-release workflow with proper credentials ([235d49c](https://github.com/bit2me-devs/bit2me-mcp/commit/235d49c0bda41e08b5c7bb1ea651f6502e8e1e6d))
- correct wallet address mapper and add pocket details mapper ([b392a69](https://github.com/bit2me-devs/bit2me-mcp/commit/b392a6968a80d6f59c76e0e3936088a2bf2fd016))
- improve npm token verification in release workflow ([1e89869](https://github.com/bit2me-devs/bit2me-mcp/commit/1e89869d850c8e2c307102c624a53e5e9e0a2071))
- improve semantic-release configuration ([88ea71c](https://github.com/bit2me-devs/bit2me-mcp/commit/88ea71c4ff0b0e753f6806ded20a9532097af6f0))
- **landing:** update github link in sidebar ([d11afe1](https://github.com/bit2me-devs/bit2me-mcp/commit/d11afe1d52e5cc66d5c18151726c45fe7ef7cae2))
- remove workaround from semantic-release workflow ([0043544](https://github.com/bit2me-devs/bit2me-mcp/commit/00435447f72dd6986215b175f078de4c6e256a5c))
- resolve all eslint warnings and improve type safety ([823d262](https://github.com/bit2me-devs/bit2me-mcp/commit/823d26293d5dda49a2f5b3eb8ef7351aed5005a0))
- update Node.js version to 22 for semantic-release compatibility ([f78f88f](https://github.com/bit2me-devs/bit2me-mcp/commit/f78f88f2b292290abc5910dfdfeffc5e013e0e56))

### Features

- add optional raw_response support in mapped responses ([623413b](https://github.com/bit2me-devs/bit2me-mcp/commit/623413b5b69cbd7629ea96e1f3aae381d5bfb871))
- improve landing page and git hooks management ([bbb1364](https://github.com/bit2me-devs/bit2me-mcp/commit/bbb1364b5d3bff5ca8ad8809dedb8da30493787c))

# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

## [1.1.2] - 2025-11-26

### Added

- **Landing Page Improvements**:
    - New "Prerequisites" section explaining how to obtain API Keys.
    - Tabbed installation instructions for **Claude Desktop**, **Cursor IDE**, **Windsurf**, **Gemini CLI**, and **VS Code**.
    - Detailed `mcp_config.json` examples for each platform.
    - Explicit warning about Cursor's environment variable limitations (requires `.env` file).

### Fixed

- **Documentation Accuracy**:
    - Corrected total tool count from 48 to **47** in both `landing/index.html` and `README.md`.
    - Updated tool breakdown list in `README.md` to match the actual implementation (8 Market, 7 Wallet, 11 Earn, 9 Loan, 10 Pro, 1 Account, 1 Aggregation).

## [1.1.1] - 2025-11-26

### Fixed

- Added missing `repository` field to `package.json` for NPM metadata.

## [1.1.0] - 2025-11-26

### Added

- **Landing Page Enhancements**:
    - Predictive search with suggestions and auto-scroll.
    - New "Tools Reference" section name (previously API Reference).
    - Added "Parameters & Validation" and "Server & Maintenance" troubleshooting guides.
    - Improved JSON example indentation and visualization.
    - Updated footer links (GitHub, Bit2Me Website, API Docs).
- **Documentation**:
    - Added GitHub repository button with logo in Hero section.
    - Updated all repository references to `bit2me-devs/bit2me-mcp`.

### Changed

- **Code Refactoring**:
    - Flattened `src/tools` directory structure (removed `assets`, `market`, `aggregation` subfolders).
    - Moved `schemas.ts` from `src/types/` to `src/utils/`.
    - Updated import paths across the project to reflect new structure.
- **Tool Logic**:
    - Unified return types in tool handlers (replaced `null` returns with explicit Errors for MCP SDK compatibility).

### Fixed

- Corrected argument definitions in landing page examples for `wallet_create_proforma`, `earn_create_transaction`, `loan_get_ltv`, and others.
- Fixed build errors related to strict type checking in tool handlers.
- Resolved test import path issues after directory restructuring.

### Added (Previous)

- Complete mapper coverage (47/47 tools with optimized responses)
- TypeScript strict mode enforcement
- ESLint configuration with TypeScript rules
- Prettier code formatting
- Pre-commit hooks with Husky
- Comprehensive CI/CD workflows
- Code quality badges in README
- Barrel exports for utilities
- Pull request template
- Dependabot configuration
- Semantic release automation
- Code coverage reporting

### Changed

- Consolidated API service layer (merged `api.ts` and `auth.ts` into `services/bit2me.ts`)
- Internationalized all code comments and documentation to English
- Enhanced error handling with custom error classes
- Improved logging with structured logger and data sanitization
- Updated deployment workflow with pre-deployment validation

### Fixed

- Missing mapper for `pro_get_order_details` tool
- Exponential backoff implementation with configurable limits
- Rate limit handling with proper retry logic

### Security

- Sanitized sensitive data in logs (API keys, signatures)
- Strict TypeScript type checking
- Input validation with type guards on all mappers

---

## [1.0.0] - 2025-11-25

### Added

- Initial release of Bit2Me MCP Server
- 47 tools across 8 categories:
    - 8 Market tools (public data)
    - 7 Wallet tools (private)
    - 12 Earn/Staking tools
    - 11 Loan tools
    - 8 Pro Trading tools
    - 1 Account tool
    - 1 Portfolio aggregation tool
    - 11 Operation tools (write actions)
- Automatic retry mechanism for rate-limited requests
- Exponential backoff with jitter
- Comprehensive test suite (31 tests)
- Documentation:
    - Complete README with all 47 tools
    - SCHEMA_MAPPING.md with JSON examples
    - TypeScript schema coverage documentation
    - Product marketing documentation
- Landing page with GitHub Pages deployment
- Environment-based configuration
- MCP SDK integration

### Security

- Secure API authentication with signature generation
- Environment variable validation with Zod
- No hardcoded credentials

---

## Release Notes

### Version Numbering

This project follows [Semantic Versioning](https://semver.org/):

- **MAJOR** version for incompatible API changes
- **MINOR** version for new functionality in a backwards compatible manner
- **PATCH** version for backwards compatible bug fixes

### Automated Releases

Releases are automated using [semantic-release](https://github.com/semantic-release/semantic-release).
Version bumps are determined by commit message conventions.

### Commit Convention

We follow [Conventional Commits](https://www.conventionalcommits.org/):

- `feat:` - New features (minor version bump)
- `fix:` - Bug fixes (patch version bump)
- `docs:` - Documentation changes (no version bump)
- `style:` - Code style changes (no version bump)
- `refactor:` - Code refactoring (no version bump)
- `perf:` - Performance improvements (patch version bump)
- `test:` - Test changes (no version bump)
- `chore:` - Build/dependency changes (no version bump)
- `ci:` - CI/CD changes (no version bump)

Add `BREAKING CHANGE:` in commit body for major version bumps.

---

## [Links]

- [Repository](https://github.com/bit2me-devs/bit2me-mcp)
- [Issues](https://github.com/bit2me-devs/bit2me-mcp/issues)
- [Pull Requests](https://github.com/bit2me-devs/bit2me-mcp/pulls)
- [Releases](https://github.com/bit2me-devs/bit2me-mcp/releases)

